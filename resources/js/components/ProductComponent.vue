<template>
  <div class="productComponent">
    <div class="container my-5">
      <div class="row d-flex justify-content-end my-3">
        <div class="col-md-5">
          <button class="btn btn-primary" @click="create">
            <i class="fas fa-plus-circle me-2"></i>
            Create
          </button>
        </div>
        <!--Search Product-->
        <div class="col-md-3">
          <form @submit.prevent="view">
            <div class="input-group">
              <input
                type="text"
                v-model="search"
                class="form-control"
                placeholder="Searh Product"
              />
              <button class="btn btn-primary">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </form>
        </div>
        <!--end Search-->
      </div>

      <div class="row">
        <!--Input Form-->
        <div class="col-md-4">
          <div class="card">
            <div class="card-header">
              <h4>{{ isEditMode ? "Edit" : "Create" }}</h4>
            </div>
            <div class="card-body">
              <form @submit.prevent="isEditMode ? update() : store()">
                <div class="form-group my-3">
                  <label for="name">Name :</label>
                  <input
                    type="text"
                    class="form-control"
                    id="name"
                    v-model="product.name"
                  />
                </div>
                <div class="form-group my-3">
                  <label for="price">Price :</label>
                  <input
                    type="number"
                    class="form-control"
                    id="price"
                    v-model="product.price"
                  />
                </div>
                <button class="btn btn-primary">
                  <i class="fas fa-save me-2"></i> Save
                </button>
              </form>
            </div>
          </div>
        </div>
        <!--End Input Form-->

        <!--Table-->
        <div class="col-md-8">
          <table class="table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Price</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="product in products.data" :key="product.id">
                <td>{{ product.id }}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.price }}</td>
                <td>
                  <button class="btn btn-sm btn-success" @click="edit(product)">
                    <i class="fas fa-edit me-2"></i>Edit
                  </button>
                  <button
                    class="btn btn-sm btn-danger"
                    @click="deleteBtn(product.id)"
                  >
                    <i class="fas fa-trash-alt me-2"></i>Delete
                  </button>
                </td>
              </tr>
            </tbody>
          </table>

          <div class="d-flex justify-content-start">
            <advanced-laravel-vue-paginate
              class="mt-2 shadow-sm"
              :data="products"
              @paginateTo="view"
            />
          </div>
        </div>
        <!--End Table-->
      </div>
    </div>
  </div>
</template>

<script>
import axios from "axios";

export default {
  name: "ProductComponent",
  data() {
    return {
      isEditMode: false,
      products: {},
      search: "",
      product: {
        id: "",
        name: "",
        price: "",
      },
    };
  },

  methods: {
    view(page = 1) {
      axios
        .get(`/api/products?page=${page}&search=${this.search}`)
        .then((res) => (this.products = res.data))
        .catch((err) => console.log(err));
    },

    store() {
      axios
        .post("/api/product/store", this.product)
        .then(() => {
          this.view();
          this.product = { id: "", name: "", price: "" };
        })
        .catch();
    },

    create() {
      this.isEditMode = false;
      this.product = { id: "", name: "", price: "" };
    },

    edit(product) {
      this.isEditMode = true;
      this.product.id = product.id;
      this.product.name = product.name;
      this.product.price = product.price;
    },

    update() {
      axios
        .put(`/api/product/${this.product.id}`, this.product)
        .then(() => {
          this.view();
          this.create();
        })
        .catch((err) => console.log(err));
    },

    deleteBtn(id) {
      if (!confirm("Are you sure to delete?")) return;

      axios
        .delete(`/api/product/${id}`)
        .then(() => this.view())
        .catch((err) => console.log(err));
    },
  },

  created() {
    this.view();
  },
};
</script>

<style>
</style>
